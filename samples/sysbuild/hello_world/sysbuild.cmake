# Copyright (c) 2024 Nordic Semiconductor ASA
# SPDX-License-Identifier: Apache-2.0

set(FACTORY_BASE_DIR ${ZEPHYR_BASE}/samples/subsys/nvs/factory)

ExternalProject_Add(nvs_factory_tool
  SOURCE_DIR ${FACTORY_BASE_DIR}
  CMAKE_ARGS
  -DFACTORY_BINARY_DIR=${APPLICATION_BINARY_DIR}/factory
  -DFACTORY_NVS_CONTENT_FILE=${FACTORY_BASE_DIR}/src/demo_nvs_content.c
  -DFACTORY_NVS_OUTPUT_FILE=${APPLICATION_BINARY_DIR}/include/nvs_area.h
  -DFACTORY_NVS_PARTITION_DT_LABEL=storage_partition
  -DFACTORY_NVS_LINKER_SECTION=nvs_partition
  -DBOARD=native_sim
  -DFACTORY_FLASH_ERASE_VALUE=0xFF
  -DFACTORY_FLASH_ERASE_BLOCK_SIZE=0x800
  -DFACTORY_FLASH_WRITE_BLOCK_SIZE=0x2
  -DFACTORY_NVS_PARTITION_SIZE=0x1800
  INSTALL_COMMAND ""
  TEST_AFTER_INSTALL TRUE
)
add_dependencies(${DEFAULT_IMAGE} nvs_factory_tool)
